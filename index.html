<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>MoodBoard - App Sections</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        body {
            min-height: 100vh;
        }
        .section-card {
            transition: all 0.3s ease;
        }
        .section-card:hover {
            transform: translateY(-4px);
        }
        .thumbnail-stack {
            position: relative;
            height: 120px;
            width: 100%;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .thumbnail-card {
            position: absolute;
            width: 80px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .thumbnail-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .thumbnail-card:nth-child(1) {
            z-index: 5;
            transform: translateX(-30px) rotate(-3deg);
        }
        .thumbnail-card:nth-child(2) {
            z-index: 4;
            transform: translateX(-15px) rotate(-1.5deg);
        }
        .thumbnail-card:nth-child(3) {
            z-index: 3;
            transform: translateX(0) rotate(0deg);
        }
        .thumbnail-card:nth-child(4) {
            z-index: 2;
            transform: translateX(15px) rotate(1.5deg);
        }
        .thumbnail-card:nth-child(5) {
            z-index: 1;
            transform: translateX(30px) rotate(3deg);
        }
        .section-card:hover .thumbnail-card:nth-child(1) {
            transform: translateX(-35px) rotate(-4deg) translateY(-5px);
        }
        .section-card:hover .thumbnail-card:nth-child(2) {
            transform: translateX(-18px) rotate(-2deg) translateY(-3px);
        }
        .section-card:hover .thumbnail-card:nth-child(3) {
            transform: translateX(0) rotate(0deg) translateY(-5px);
        }
        .section-card:hover .thumbnail-card:nth-child(4) {
            transform: translateX(18px) rotate(2deg) translateY(-3px);
        }
        .section-card:hover .thumbnail-card:nth-child(5) {
            transform: translateX(35px) rotate(4deg) translateY(-5px);
        }
        .item-count-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(168, 142, 72, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            z-index: 1;
        }
        .thumbnail-stack {
            position: relative;
            z-index: 1;
        }
        #auth-modal {
            display: none;
        }
        #auth-modal.show {
            display: flex;
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#a88e48",
                        "background-light": "#f7f7f6",
                        "background-dark": "#1d1b15",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "Noto Sans", "sans-serif"]
                    },
                },
            },
        }
    </script>
    <!-- Load Supabase config and client -->
    <script src="supabase-config.js"></script>
    <script src="supabase-client.js"></script>
</head>
<body class="bg-background-dark font-display">
    <!-- User Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[3000] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-[#2a271f] rounded-xl border border-[#3e3a2d] w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-4">
                    <img src="SunBurst2.webp" alt="Logo" class="w-12 h-12 object-contain">
                    <h2 class="text-white text-xl font-bold">Welcome to MoodBoard</h2>
                </div>
                <p class="text-white/70 text-sm mb-6">
                    Please enter your name and email to access the design previews. This helps us track feedback and improve the design process.
                </p>
                <form id="auth-form" class="space-y-4">
                    <div>
                        <label for="user-name" class="block text-white/80 text-sm font-medium mb-2">Name</label>
                        <input type="text" id="user-name" required
                               class="w-full px-4 py-3 bg-[#1d1b15] border border-[#3e3a2d] rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-primary"
                               placeholder="Your name">
                    </div>
                    <div>
                        <label for="user-email" class="block text-white/80 text-sm font-medium mb-2">Email</label>
                        <input type="email" id="user-email" required
                               class="w-full px-4 py-3 bg-[#1d1b15] border border-[#3e3a2d] rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-primary"
                               placeholder="your.email@example.com">
                    </div>
                    <button type="submit" 
                            class="w-full h-12 rounded-xl bg-primary text-background-dark font-bold text-base tracking-wide hover:bg-primary/90 transition-colors">
                        Continue
                    </button>
                </form>
            </div>
        </div>
    </div>
    <div class="min-h-screen pb-8">
        <header id="main-header" class="sticky top-0 z-10 w-full bg-background-dark/80 backdrop-blur-sm border-b border-[#3e3a2d] transition-all duration-300">
            <div id="header-content" class="flex flex-col items-center py-3 px-4 relative transition-all duration-300">
                <img id="header-logo" src="SunBurst2.webp" alt="Logo" class="w-12 h-12 object-contain transition-all duration-300 mb-1">
                <h1 id="header-title" class="text-white text-lg font-bold tracking-tight transition-all duration-300">MoodBoard</h1>
                <!-- User info and logout -->
                <div id="user-info" class="absolute top-2 right-4 hidden">
                    <div class="flex items-center gap-2">
                        <span id="user-name-display" class="text-white/70 text-xs"></span>
                        <button id="logout-btn" class="text-white/50 hover:text-white text-xs underline" title="Logout">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Disclaimer/Description -->
        <div class="container mx-auto px-4 pt-8 max-w-4xl">
            <div class="bg-[#2a271f] border border-primary/30 rounded-xl p-6 mb-8">
                <div class="flex items-start gap-3 mb-4">
                    <span class="material-symbols-outlined text-primary text-2xl">info</span>
                    <h2 class="text-white text-lg font-bold">Visual Mood Exploration ‚Äî Not Final Designs</h2>
                </div>
                <p class="text-white/80 text-sm leading-relaxed mb-4">
                    These are <strong class="text-white">pre-wireframe visual previews</strong> for vibe-checking and taste direction. They are <strong class="text-white">not finished designs</strong> or final UI/UX work.
                </p>
                <p class="text-white/70 text-sm leading-relaxed mb-4">
                    These mood previews help us understand your preferences for colors, layout styles, tone, and personality <em>before</em> committing to wireframe direction. Think of them as visual references to guide the design process, not designs to be implemented.
                </p>
                <div class="bg-[#1d1b15] border border-[#3e3a2d] rounded-lg p-4 mb-4">
                    <p class="text-white/90 text-sm font-semibold mb-2">üí° As you review, consider:</p>
                    <ul class="text-white/70 text-sm space-y-1.5 list-disc list-inside">
                        <li>What do you like about these previews?</li>
                        <li>What feels wrong or off-brand?</li>
                        <li>Are any colors or layouts catching your eye?</li>
                        <li>Which ones feel closest to your brand's vibe?</li>
                    </ul>
                </div>
                <div class="bg-primary/10 border border-primary/30 rounded-lg p-4">
                    <div class="flex items-start gap-3 mb-2">
                        <span class="material-symbols-outlined text-primary text-xl">rate_review</span>
                        <div class="flex-1">
                            <p class="text-white/90 text-sm font-semibold mb-1">How to Leave Feedback</p>
                            <p class="text-white/70 text-xs leading-relaxed">
                                When viewing any design, click the <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-white/10 text-white text-xs mx-1">üìù</span> notes button in the top-right corner to:
                            </p>
                            <ul class="text-white/70 text-xs space-y-1 mt-2 list-disc list-inside">
                                <li>Rate the design (1-10)</li>
                                <li>Give a quick thumbs up or down</li>
                                <li>Add detailed notes and observations</li>
                            </ul>
                            <p class="text-white/60 text-xs mt-2 italic">
                                Your feedback is saved automatically and helps guide the design direction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <main class="container mx-auto px-4 py-8 max-w-6xl">
            <div id="sections-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Sections will be loaded dynamically -->
            </div>
        </main>
    </div>

    <script>
        // Check authentication and load sections
        async function initApp() {
            // Check if user is authenticated
            if (!isAuthenticated()) {
                document.getElementById('auth-modal').classList.add('show');
                return;
            }

            // User is authenticated, hide modal and load sections
            document.getElementById('auth-modal').classList.remove('show');
            await loadSections();
        }

        async function loadSections() {
            try {
                // Try to fetch from Supabase first
                let sections = await fetchSections();
                
                if (sections && sections.length > 0) {
                    // Transform Supabase data to match expected format
                    sections = sections.map(s => ({
                        name: s.name,
                        folder: s.folder_path,
                        icon: s.icon
                    }));
                    renderSections(sections);
                    return;
                }
            } catch (error) {
                console.error('Error fetching from Supabase:', error);
            }

            // Fallback: Try embedded data or manifest-loader
            try {
                if (typeof sectionsData !== 'undefined' && sectionsData.sections) {
                    renderSections(sectionsData.sections);
                } else if (typeof getManifestForSection === 'function') {
                    // Try to get sections from manifest-loader
                    console.log('Using fallback: manifest-loader');
                } else {
                    throw new Error('No data source available');
                }
            } catch (error) {
                console.error('Error loading sections:', error);
                document.getElementById('sections-grid').innerHTML = 
                    '<div class="col-span-full text-center text-white/60 p-8">' +
                    '<p class="mb-4">Unable to load sections.</p>' +
                    '<p class="text-sm">Please configure Supabase or ensure manifest-loader.js is available.</p>' +
                    '</div>';
            }
        }

        async function renderSections(sections) {
            const grid = document.getElementById('sections-grid');
            grid.innerHTML = '';

            for (const section of sections) {
                const sectionCard = document.createElement('a');
                sectionCard.href = `gallery.html?section=${encodeURIComponent(section.folder)}&name=${encodeURIComponent(section.name)}`;
                sectionCard.className = 'section-card block';
                
                // Try to get thumbnails from Supabase
                let thumbnails = [];
                let itemCount = 0;
                
                try {
                    const items = await fetchGalleryItems(section.folder);
                    if (items && items.length > 0) {
                        itemCount = items.length;
                        thumbnails = items.slice(0, 5).map(item => item.thumbnail);
                    }
                } catch (error) {
                    console.log('Could not fetch thumbnails from Supabase:', error);
                }
                
                // Fallback to manifest-loader if Supabase fails
                if (thumbnails.length === 0 && typeof getManifestForSection === 'function') {
                    const manifest = getManifestForSection(section.folder);
                    if (manifest && manifest.items) {
                        itemCount = manifest.items.length;
                        thumbnails = manifest.items.slice(0, 5).map(item => item.thumbnail);
                    }
                }
                
                // Create thumbnail stack HTML
                let thumbnailStackHTML = '';
                if (thumbnails.length > 0) {
                    thumbnailStackHTML = '<div class="thumbnail-stack">';
                    thumbnails.forEach((thumbnail, index) => {
                        thumbnailStackHTML += `
                            <div class="thumbnail-card">
                                <img src="${thumbnail}" alt="" loading="lazy" 
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'120\\'%3E%3Crect fill=\\'%232a271f\\' width=\\'80\\' height=\\'120\\'/%3E%3C/svg%3E'">
                            </div>
                        `;
                    });
                    if (itemCount > 5) {
                        thumbnailStackHTML += `<div class="item-count-badge">+${itemCount - 5}</div>`;
                    }
                    thumbnailStackHTML += '</div>';
                } else {
                    // Fallback to icon if no thumbnails available
                    thumbnailStackHTML = `
                        <div class="flex items-center justify-center mb-4">
                            <span class="material-symbols-outlined text-primary text-5xl">${section.icon || 'folder'}</span>
                        </div>
                    `;
                }
                
                sectionCard.innerHTML = `
                    <div class="bg-[#2a271f] rounded-xl overflow-hidden border border-[#3e3a2d] hover:border-primary/50 transition-colors p-6 h-full">
                        ${thumbnailStackHTML}
                        <h2 class="text-white text-xl font-bold text-center mb-2">${section.name}</h2>
                        <p class="text-white/60 text-sm text-center">${itemCount > 0 ? `${itemCount} ${itemCount === 1 ? 'page' : 'pages'}` : 'Browse variants'}</p>
                    </div>
                `;
                grid.appendChild(sectionCard);
            }
        }

        // Handle authentication form
        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            
            if (!name || !email) {
                alert('Please enter both name and email');
                return;
            }
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Loading...';
            submitBtn.disabled = true;
            
            try {
                // Get or create user in Supabase
                const user = await getOrCreateUser(name, email);
                
                if (user) {
                    setCurrentUser(user);
                    document.getElementById('auth-modal').classList.remove('show');
                    await loadSections();
                } else {
                    // Fallback: store in localStorage if Supabase not available
                    setCurrentUser({ name, email, id: 'local_' + Date.now() });
                    document.getElementById('auth-modal').classList.remove('show');
                    await loadSections();
                }
            } catch (error) {
                console.error('Authentication error:', error);
                alert('Error authenticating. Please try again.');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Show user info if authenticated
        function updateUserInfo() {
            const user = getCurrentUser();
            const userInfo = document.getElementById('user-info');
            const userNameDisplay = document.getElementById('user-name-display');
            
            if (user) {
                userInfo.classList.remove('hidden');
                userNameDisplay.textContent = user.name || user.email || 'User';
            } else {
                userInfo.classList.add('hidden');
            }
        }

        // Logout handler
        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                logoutUser();
            }
        });

        // Header scroll behavior
        let lastScrollTop = 0;
        function handleHeaderScroll() {
            const header = document.getElementById('main-header');
            const headerContent = document.getElementById('header-content');
            const logo = document.getElementById('header-logo');
            const title = document.getElementById('header-title');
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > 50) {
                // Scrolled down - make header compact (50px)
                header.style.height = '50px';
                headerContent.classList.add('py-1');
                headerContent.classList.remove('py-3');
                logo.classList.add('w-8', 'h-8', 'mb-0');
                logo.classList.remove('w-12', 'h-12', 'mb-1');
                title.classList.add('text-sm', 'hidden');
                title.classList.remove('text-lg');
            } else {
                // At top - show full header
                header.style.height = 'auto';
                headerContent.classList.remove('py-1');
                headerContent.classList.add('py-3');
                logo.classList.remove('w-8', 'h-8', 'mb-0');
                logo.classList.add('w-12', 'h-12', 'mb-1');
                title.classList.remove('text-sm', 'hidden');
                title.classList.add('text-lg');
            }
            lastScrollTop = scrollTop;
        }

        // Initialize app on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for Supabase client to initialize
            setTimeout(() => {
                initApp();
                updateUserInfo();
            }, 500);
            
            // Add scroll listener for header
            window.addEventListener('scroll', handleHeaderScroll);
            handleHeaderScroll(); // Initial check
        });
    </script>
</body>
</html>

